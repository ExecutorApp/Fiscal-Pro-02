<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste PDF.js - Navegador Externo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        #pdfCanvas {
            border: 1px solid #ddd;
            margin: 20px 0;
            max-width: 100%;
        }
        .test-info {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .network-info {
            background-color: #e2e3e5;
            color: #383d41;
            border: 1px solid #d6d8db;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Teste de Compatibilidade PDF.js</h1>
        
        <div class="test-info">
            <strong>üìã Informa√ß√µes do Teste:</strong><br>
            ‚Ä¢ Esta p√°gina testa se o PDF.js funciona corretamente em navegadores externos<br>
            ‚Ä¢ Navegador: <span id="browserInfo"></span><br>
            ‚Ä¢ Data/Hora: <span id="timestamp"></span>
        </div>
        
        <div class="network-info">
            <strong>üåê URLs de Acesso:</strong><br>
            ‚Ä¢ Local: <a href="http://localhost:5174/" target="_blank">http://localhost:5174/</a><br>
            ‚Ä¢ Rede: <a href="http://192.168.0.107:5174/" target="_blank">http://192.168.0.107:5174/</a><br>
            ‚Ä¢ Teste PDF: <a href="http://localhost:5174/test-pdf.html" target="_blank">http://localhost:5174/test-pdf.html</a>
        </div>
        
        <div id="status" class="status info">üîÑ Inicializando teste...</div>
        
        <canvas id="pdfCanvas" style="display: none;"></canvas>
        
        <div id="details"></div>
        
        <div style="margin-top: 30px; padding: 15px; background-color: #f8f9fa; border-radius: 4px;">
            <h3>üìù Instru√ß√µes para Teste Manual:</h3>
            <ol>
                <li>Abra esta URL em um navegador externo (Chrome, Firefox, Edge)</li>
                <li>Verifique se o PDF √© carregado e renderizado corretamente</li>
                <li>Teste a navega√ß√£o entre p√°ginas</li>
                <li>Teste o zoom in/out</li>
                <li>Verifique se n√£o h√° erros no console do navegador (F12)</li>
            </ol>
        </div>
    </div>

    <script type="module">
        // Configurar informa√ß√µes da p√°gina
        document.getElementById('timestamp').textContent = new Date().toLocaleString('pt-BR');
        document.getElementById('browserInfo').textContent = navigator.userAgent;
        
        const statusDiv = document.getElementById('status');
        const detailsDiv = document.getElementById('details');
        const canvas = document.getElementById('pdfCanvas');
        
        function updateStatus(message, type = 'info') {
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
        }
        
        function addDetail(message) {
            const p = document.createElement('p');
            p.innerHTML = `‚è∞ ${new Date().toLocaleTimeString('pt-BR')}: ${message}`;
            detailsDiv.appendChild(p);
        }
        
        async function testPdfJs() {
            try {
                updateStatus('üîÑ Importando PDF.js...', 'info');
                addDetail('Iniciando importa√ß√£o do PDF.js');
                
                // Importar PDF.js dinamicamente usando vers√£o legacy para melhor compatibilidade
      const pdfjsLib = await import('/node_modules/pdfjs-dist/legacy/build/pdf.min.mjs');
                addDetail('‚úÖ PDF.js importado com sucesso');
                
                // Configurar worker
                const workerUrl = `${window.location.origin}/pdf.worker.min.js`;
                pdfjsLib.GlobalWorkerOptions.workerSrc = workerUrl;
                addDetail(`üîß Worker configurado: ${workerUrl}`);
                
                updateStatus('üîÑ Testando carregamento do worker...', 'info');
                
                // Testar se o worker est√° acess√≠vel
                const workerResponse = await fetch(workerUrl);
                if (!workerResponse.ok) {
                    throw new Error(`Worker n√£o encontrado: ${workerResponse.status}`);
                }
                addDetail('‚úÖ Worker PDF.js acess√≠vel');
                
                updateStatus('üîÑ Carregando documento PDF de teste...', 'info');
                
                // Carregar PDF de teste
                const pdfUrl = `${window.location.origin}/test-document.pdf`;
                const loadingTask = pdfjsLib.getDocument(pdfUrl);
                
                const pdf = await loadingTask.promise;
                addDetail(`‚úÖ PDF carregado: ${pdf.numPages} p√°ginas`);
                
                updateStatus('üîÑ Renderizando primeira p√°gina...', 'info');
                
                // Renderizar primeira p√°gina
                const page = await pdf.getPage(1);
                const viewport = page.getViewport({ scale: 1.0 });
                
                canvas.width = viewport.width;
                canvas.height = viewport.height;
                canvas.style.display = 'block';
                
                const context = canvas.getContext('2d');
                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                
                await page.render(renderContext).promise;
                addDetail('‚úÖ P√°gina renderizada com sucesso');
                
                updateStatus('üéâ Teste conclu√≠do com SUCESSO! PDF.js est√° funcionando corretamente em navegadores externos.', 'success');
                
            } catch (error) {
                console.error('Erro no teste:', error);
                updateStatus(`‚ùå ERRO: ${error.message}`, 'error');
                addDetail(`‚ùå Erro detalhado: ${error.stack || error.message}`);
                
                // Sugest√µes de solu√ß√£o
                addDetail('üí° Poss√≠veis solu√ß√µes:');
                addDetail('‚Ä¢ Verifique se o servidor est√° rodando corretamente');
                addDetail('‚Ä¢ Teste em um navegador diferente');
                addDetail('‚Ä¢ Verifique o console do navegador (F12) para mais detalhes');
                addDetail('‚Ä¢ Certifique-se de que n√£o h√° bloqueadores de conte√∫do ativos');
            }
        }
        
        // Iniciar teste quando a p√°gina carregar
        testPdfJs();
    </script>
</body>
</html>